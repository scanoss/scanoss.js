import fs from 'fs'
import { goSumParser } from '../../src/lib/dependencies/LocalDependency/parsers/golangParser'
import { ILocalDependency } from '../../src/lib/dependencies/LocalDependency/DependencyTypes'
import { expect } from 'chai';


describe('Suit test for go sum parser', function() {


  it('Testing valids go.sum files', function (){
    const tests: [{
      inputPath: string;
      expectedResult: ILocalDependency;
    }] = [{
      inputPath: "./tests/data/dependencies/go.sum/1/go.sum",
      expectedResult: {file: 'go.sum', purls: [
          {purl:"pkg:golang/cloud.google.com/go", requirement:"v0.26.0"},
          {purl:"pkg:golang/cloud.google.com/go", requirement:"v0.34.0"},
          {purl:"pkg:golang/github.com/BurntSushi/toml", requirement:"v0.3.1"},
          {purl:"pkg:golang/github.com/antihax/optional", requirement:"v1.0.0"},
          {purl:"pkg:golang/github.com/census-instrumentation/opencensus-proto", requirement:"v0.2.1"},
          {purl:"pkg:golang/github.com/cespare/xxhash/v2", requirement:"v2.1.1"},
          {purl:"pkg:golang/github.com/client9/misspell", requirement:"v0.3.4"},
          {purl:"pkg:golang/github.com/cncf/udpa/go", requirement:"v0.0.0-20191209042840-269d4d468f6f"},
          {purl:"pkg:golang/github.com/cncf/udpa/go", requirement:"v0.0.0-20201120205902-5459f2c99403"},
          {purl:"pkg:golang/github.com/cncf/udpa/go", requirement:"v0.0.0-20210930031921-04548b0d99d4"},
          {purl:"pkg:golang/github.com/cncf/xds/go", requirement:"v0.0.0-20210805033703-aa0b78936158"},
          {purl:"pkg:golang/github.com/cncf/xds/go", requirement:"v0.0.0-20210922020428-25de7278fc84"},
          {purl:"pkg:golang/github.com/cncf/xds/go", requirement:"v0.0.0-20211011173535-cb28da3451f1"},
          {purl:"pkg:golang/github.com/davecgh/go-spew", requirement:"v1.1.0"},
          {purl:"pkg:golang/github.com/envoyproxy/go-control-plane", requirement:"v0.9.0"},
          {purl:"pkg:golang/github.com/envoyproxy/go-control-plane", requirement:"v0.9.1-0.20191026205805-5f8ba28d4473"},
          {purl:"pkg:golang/github.com/envoyproxy/go-control-plane", requirement:"v0.9.4"},
          {purl:"pkg:golang/github.com/envoyproxy/go-control-plane", requirement:"v0.9.9-0.20201210154907-fd9021fe5dad"},
          {purl:"pkg:golang/github.com/envoyproxy/go-control-plane", requirement:"v0.9.10-0.20210907150352-cf90f659a021"},
          {purl:"pkg:golang/github.com/envoyproxy/protoc-gen-validate", requirement:"v0.1.0"},
          {purl:"pkg:golang/github.com/ghodss/yaml", requirement:"v1.0.0"},
          {purl:"pkg:golang/github.com/golang/glog", requirement:"v0.0.0-20160126235308-23def4e6c14b"},
          {purl:"pkg:golang/github.com/golang/mock", requirement:"v1.1.1"},
          {purl:"pkg:golang/github.com/golang/protobuf", requirement:"v1.2.0"},
          {purl:"pkg:golang/github.com/golang/protobuf", requirement:"v1.3.2"},
          {purl:"pkg:golang/github.com/golang/protobuf", requirement:"v1.3.3"},
          {purl:"pkg:golang/github.com/golang/protobuf", requirement:"v1.4.0-rc.1"},
          {purl:"pkg:golang/github.com/golang/protobuf", requirement:"v1.4.0-rc.1.0.20200221234624-67d41d38c208"},
          {purl:"pkg:golang/github.com/golang/protobuf", requirement:"v1.4.0-rc.2"},
          {purl:"pkg:golang/github.com/golang/protobuf", requirement:"v1.4.0-rc.4.0.20200313231945-b860323f09d0"},
          {purl:"pkg:golang/github.com/golang/protobuf", requirement:"v1.4.0"},
          {purl:"pkg:golang/github.com/golang/protobuf", requirement:"v1.4.1"},
          {purl:"pkg:golang/github.com/golang/protobuf", requirement:"v1.4.2"},
          {purl:"pkg:golang/github.com/golang/protobuf", requirement:"v1.4.3"},
          {purl:"pkg:golang/github.com/golang/protobuf", requirement:"v1.5.0"},
          {purl:"pkg:golang/github.com/golang/protobuf", requirement:"v1.5.0"},
          {purl:"pkg:golang/github.com/google/go-cmp", requirement:"v0.2.0"},
          {purl:"pkg:golang/github.com/google/go-cmp", requirement:"v0.3.0"},
          {purl:"pkg:golang/github.com/google/go-cmp", requirement:"v0.3.1"},
          {purl:"pkg:golang/github.com/google/go-cmp", requirement:"v0.4.0"},
          {purl:"pkg:golang/github.com/google/go-cmp", requirement:"v0.5.0"},
          {purl:"pkg:golang/github.com/google/go-cmp", requirement:"v0.5.5"},
          {purl:"pkg:golang/github.com/google/go-cmp", requirement:"v0.5.5"},
          {purl:"pkg:golang/github.com/google/uuid", requirement:"v1.1.2"},
          {purl:"pkg:golang/github.com/grpc-ecosystem/grpc-gateway", requirement:"v1.16.0"},
          {purl:"pkg:golang/github.com/pmezard/go-difflib", requirement:"v1.0.0"},
          {purl:"pkg:golang/github.com/prometheus/client_model", requirement:"v0.0.0-20190812154241-14fe0d1b01d4"},
          {purl:"pkg:golang/github.com/rogpeppe/fastuuid", requirement:"v1.2.0"},
          {purl:"pkg:golang/github.com/stretchr/objx", requirement:"v0.1.0"},
          {purl:"pkg:golang/github.com/stretchr/testify", requirement:"v1.5.1"},
          {purl:"pkg:golang/github.com/stretchr/testify", requirement:"v1.7.0"},
          {purl:"pkg:golang/go.opentelemetry.io/proto/otlp", requirement:"v0.7.0"},
          {purl:"pkg:golang/golang.org/x/crypto", requirement:"v0.0.0-20190308221718-c2843e01d9a2"},
          {purl:"pkg:golang/golang.org/x/crypto", requirement:"v0.0.0-20200622213623-75b288015ac9"},
          {purl:"pkg:golang/golang.org/x/exp", requirement:"v0.0.0-20190121172915-509febef88a4"},
          {purl:"pkg:golang/golang.org/x/lint", requirement:"v0.0.0-20181026193005-c67002cb31c3"},
          {purl:"pkg:golang/golang.org/x/lint", requirement:"v0.0.0-20190227174305-5b3e6a55c961"},
          {purl:"pkg:golang/golang.org/x/lint", requirement:"v0.0.0-20190313153728-d0100b6bd8b3"},
          {purl:"pkg:golang/golang.org/x/net", requirement:"v0.0.0-20180724234803-3673e40ba225"},
          {purl:"pkg:golang/golang.org/x/net", requirement:"v0.0.0-20180826012351-8a410e7b638d"},
          {purl:"pkg:golang/golang.org/x/net", requirement:"v0.0.0-20190108225652-1e06a53dbb7e"},
          {purl:"pkg:golang/golang.org/x/net", requirement:"v0.0.0-20190213061140-3a22650c66bd"},
          {purl:"pkg:golang/golang.org/x/net", requirement:"v0.0.0-20190311183353-d8887717615a"},
          {purl:"pkg:golang/golang.org/x/net", requirement:"v0.0.0-20190404232315-eb5bcb51f2a3"},
          {purl:"pkg:golang/golang.org/x/net", requirement:"v0.0.0-20200822124328-c89045814202"},
          {purl:"pkg:golang/golang.org/x/net", requirement:"v0.0.0-20200822124328-c89045814202"},
          {purl:"pkg:golang/golang.org/x/oauth2", requirement:"v0.0.0-20180821212333-d2e6202438be"},
          {purl:"pkg:golang/golang.org/x/oauth2", requirement:"v0.0.0-20200107190931-bf48bf16ab8d"},
          {purl:"pkg:golang/golang.org/x/sync", requirement:"v0.0.0-20180314180146-1d60e4601c6f"},
          {purl:"pkg:golang/golang.org/x/sync", requirement:"v0.0.0-20181108010431-42b317875d0f"},
          {purl:"pkg:golang/golang.org/x/sync", requirement:"v0.0.0-20181221193216-37e7f081c4d4"},
          {purl:"pkg:golang/golang.org/x/sync", requirement:"v0.0.0-20190423024810-112230192c58"},
          {purl:"pkg:golang/golang.org/x/sys", requirement:"v0.0.0-20180830151530-49385e6e1522"},
          {purl:"pkg:golang/golang.org/x/sys", requirement:"v0.0.0-20190215142949-d0b11bdaac8a"},
          {purl:"pkg:golang/golang.org/x/sys", requirement:"v0.0.0-20190412213103-97732733099d"},
          {purl:"pkg:golang/golang.org/x/sys", requirement:"v0.0.0-20200323222414-85ca7c5b95cd"},
          {purl:"pkg:golang/golang.org/x/sys", requirement:"v0.0.0-20200323222414-85ca7c5b95cd"},
          {purl:"pkg:golang/golang.org/x/text", requirement:"v0.3.0"},
          {purl:"pkg:golang/golang.org/x/text", requirement:"v0.3.0"},
          {purl:"pkg:golang/golang.org/x/tools", requirement:"v0.0.0-20190114222345-bf090417da8b"},
          {purl:"pkg:golang/golang.org/x/tools", requirement:"v0.0.0-20190226205152-f727befe758c"},
          {purl:"pkg:golang/golang.org/x/tools", requirement:"v0.0.0-20190311212946-11955173bddd"},
          {purl:"pkg:golang/golang.org/x/tools", requirement:"v0.0.0-20190524140312-2c0ae7006135"},
          {purl:"pkg:golang/golang.org/x/xerrors", requirement:"v0.0.0-20191204190536-9bdfabe68543"},
          {purl:"pkg:golang/golang.org/x/xerrors", requirement:"v0.0.0-20200804184101-5ec99f83aff1"},
          {purl:"pkg:golang/golang.org/x/xerrors", requirement:"v0.0.0-20200804184101-5ec99f83aff1"},
          {purl:"pkg:golang/google.golang.org/appengine", requirement:"v1.1.0"},
          {purl:"pkg:golang/google.golang.org/appengine", requirement:"v1.4.0"},
          {purl:"pkg:golang/google.golang.org/genproto", requirement:"v0.0.0-20180817151627-c66870c02cf8"},
          {purl:"pkg:golang/google.golang.org/genproto", requirement:"v0.0.0-20190819201941-24fa4b261c55"},
          {purl:"pkg:golang/google.golang.org/genproto", requirement:"v0.0.0-20200513103714-09dca8ec2884"},
          {purl:"pkg:golang/google.golang.org/genproto", requirement:"v0.0.0-20200526211855-cb27e3aa2013"},
          {purl:"pkg:golang/google.golang.org/genproto", requirement:"v0.0.0-20200526211855-cb27e3aa2013"},
          {purl:"pkg:golang/google.golang.org/grpc", requirement:"v1.19.0"},
          {purl:"pkg:golang/google.golang.org/grpc", requirement:"v1.23.0"},
          {purl:"pkg:golang/google.golang.org/grpc", requirement:"v1.25.1"},
          {purl:"pkg:golang/google.golang.org/grpc", requirement:"v1.27.0"},
          {purl:"pkg:golang/google.golang.org/grpc", requirement:"v1.33.1"},
          {purl:"pkg:golang/google.golang.org/grpc", requirement:"v1.36.0"},
          {purl:"pkg:golang/google.golang.org/grpc", requirement:"v1.42.0"},
          {purl:"pkg:golang/google.golang.org/grpc", requirement:"v1.42.0"},
          {purl:"pkg:golang/google.golang.org/protobuf", requirement:"v0.0.0-20200109180630-ec00e32a8dfd"},
          {purl:"pkg:golang/google.golang.org/protobuf", requirement:"v0.0.0-20200221191635-4d8936d0db64"},
          {purl:"pkg:golang/google.golang.org/protobuf", requirement:"v0.0.0-20200228230310-ab0ca4ff8a60"},
          {purl:"pkg:golang/google.golang.org/protobuf", requirement:"v1.20.1-0.20200309200217-e05f789c0967"},
          {purl:"pkg:golang/google.golang.org/protobuf", requirement:"v1.21.0"},
          {purl:"pkg:golang/google.golang.org/protobuf", requirement:"v1.22.0"},
          {purl:"pkg:golang/google.golang.org/protobuf", requirement:"v1.23.0"},
          {purl:"pkg:golang/google.golang.org/protobuf", requirement:"v1.23.1-0.20200526195155-81db48ad09cc"},
          {purl:"pkg:golang/google.golang.org/protobuf", requirement:"v1.25.0"},
          {purl:"pkg:golang/google.golang.org/protobuf", requirement:"v1.26.0-rc.1"},
          {purl:"pkg:golang/google.golang.org/protobuf", requirement:"v1.27.1"},
          {purl:"pkg:golang/google.golang.org/protobuf", requirement:"v1.27.1"},
          {purl:"pkg:golang/gopkg.in/check.v1", requirement:"v0.0.0-20161208181325-20d25e280405"},
          {purl:"pkg:golang/gopkg.in/yaml.v2", requirement:"v2.2.2"},
          {purl:"pkg:golang/gopkg.in/yaml.v2", requirement:"v2.2.3"},
          {purl:"pkg:golang/gopkg.in/yaml.v3", requirement:"v3.0.0-20200313102051-9f266ea9e77c"},
          {purl:"pkg:golang/honnef.co/go/tools", requirement:"v0.0.0-20190102054323-c2f93a96b099"},
          {purl:"pkg:golang/honnef.co/go/tools", requirement:"v0.0.0-20190523083050-ea95bdfd59fc"},
        ]}
    }];

    for (const test of tests) {
      const fileContent = fs.readFileSync(test.inputPath,  {encoding:'utf-8'});
      const result = goSumParser(fileContent, 'go.sum');
      expect(result).to.deep.equal(test.expectedResult)
    }
  });

});
